## 经典网络
经典网络类型的云产品，统一部署在阿里云公共基础设施内，规划和管理由阿里云负责，更适合对网络易用性要求较高的用户，采用三次隔离。

## 专有网络
专有网络VPC是基于阿里云构建的一个隔离网络环境，专有网络之间逻辑上彻底隔离。您可以自定义这个专有网络的拓扑和IP地址，适用于对网络安全性要求较高和有一定网络管理能力的用户，采用二层隔离，相对经典网络而言，专有网络具有较高的安全性和灵活性。

##  SLB(负载均衡服务)
SLB主要用于负载均衡，通过分流网络流量来提高服务器性能。它能够将流量分发到多个服务器，平衡服务器的负载，从而提高整体性能和可靠性。SLB适用于访问量大、需要水平扩展的应用场景。通过使用SLB，可以减少单点故障的风险，并确保服务的可用性和可扩展性。
##  EIP(弹性公网IP)
EIP提供独立的公网IP资源，可以绑定到云上的各种资源上，如ECS（弹性服务器）、NAT网关、私网负载均衡SLB等。EIP可以实现公网IP与资源的解耦，满足灵活管理的需求。其主要目的是为了解决服务器IP与服务器实体之间的强关联问题。在业务发展初期，访问量较小，用户购买一个较小规格的ECS实例即可满足业务需求。但随着用户量和业务量逐渐攀升，可能需要更换更大规格的ECS或使用SLB+ECS便于后续的扩展。如果没有EIP，更换ECS意味着更换实例IP，可能导致业务中断。而EIP的出现则很好地解决了这类问题。
##  NAT网关
NAT网关主要用于网络地址转换和隔离，提高网络的安全性和可靠性。它能够将私有IP地址转换为公网IP地址，实现内网与公网的通信。NAT网关适用于私有网络中需要访问公网的场景，如企业或组织内部的网络。通过使用NAT网关，可以实现公网的访问和安全隔离，保护内部网络不被外部攻击或入侵。

* SNAT(Source Network Address Translation)：源网络地址转换，内部地址要访问公网上的服务时，内部地址会主动发起连接，将内部地址转换为公网IP。有关这个地址转换称为SNAT。
具体示例说明：
公司内部的主机A想访问互联网上的主机C，首先将请求数据包(源：ipA,目标：ipC)发送到防火墙所在的主机B，B收到后将数据包源地址改为本机公网网卡的ip(源：ipA,目标：ipB)，然后经互联网发送给C，C收到后将回应包(源：ipC,目标：ipB)转发给C的路由器，经互联网将回应包转给B，B收到回应包后修改其目的地址，将回应包(源：ipC，目标：ipA)然后将数据包转发给A。

* DNAT(Destination Network Address Translation)：目标地址转换，内部需要对外提供服务时，外部主动发起连接，路由器或者防火墙的网络接收到这个连接，然后将连接转换到内部，此过程是由带公网ip的网关代替内部服务来接收外部的连接，然后在内部做地址转换。此转换成为DNAT，主要用于内部服务对外发布。
互联网主机C想访问企业内部的web服务器A，但A的地址是私有地址，无法直接访问。此时，C可以访问防火墙的公网地址，C的请求数据包（源：ipC，目标：ipB）到达防火墙B后，在B的PREROUTING上将请求数据包的目标地址进行修改，并将数据包（源：ipC，目标：ipA）发送给A。A收到后进行回复发送响应包（源：ipA，目的ipC）到防火墙，防火墙收到后对数据包源地址进行修改，并将响应包（源：ipB，目标：ipC）给C。利用这种机制可以将企业内部的服务发布到互联网。

* 丰富的监控指标

* 同一个VPC内支持创建多个公网NAT网管

### 为已绑定EIP的ECS实力统一公网出口IP

为绑定了EIP的ESC实例单独分配一块弹性网卡，并将EIP绑定到弹性网卡上

### NAT vs EIP

如果应用需要灵活地管理和扩展公网入口，并且需要解耦服务器IP与服务器实体之间的强关联，EIP是更合适的选择。而如果应该要在私有网络中安全地访问公网，并且需要实现地址的转换和隔离，那就更适合NAT网关。

## VPN 网关

VPN网关是一款网络连接服务，通过建立加密隧道的方式实现企业本地数据中心，企业办公网络，互联网客户端与阿里云专有网络VPC之间安全可靠的私网连接。

* 安全： 使用了IKE和IPsec协议对传输数据加密，保证了数据安全
* 稳定： 采用了双击热备架构
* 简单： 开箱即用
* 低成本：相比物理专线成本低

### IPsec-VPN

支持企业本地数据中心，企业办公网络与VPC建立网络连接。

是基于路由的网络连接技术，提供灵活的流量路由方式，方便配置和维护VPN策略

IPsec连接可绑定VPN网关实例，也可以绑定转发路由器实例，通过云企业网实现网络互通

前提条件：
* 已经常见阿里云账号，创建了VPC并部署云服务
* 数据中心网关设备支持IKEv1和IKEv2协议
* 本地数据中心的网关设备已经配置了静态公网IP
* 本地数据中心与VPC互通的网段没有重叠
* 确保安全组规则允许本地数据库中心的网关设备访问云资源

### SSL—VPN
是基于OpenVPN架构的网络连接技术。适用于在互联网客户与VPC之间建立网络连接。

部署后，仅需要再互联网客户端中加载证书并发起连接，互联网客户就可以与VPC互通。

SSL—VPN仅支持绑定国际标准商用密码算法的公用VPN网关实例

## 智能接入网关
是阿里云提供的软件定义广域网SD-WAN解决方案。企业可通过智能接入网关实现一站式接入阿里云，获得更加智能，安全和可靠的上云体验。

三个产品形态：
* 硬件CPE设备形态 
* 镜像vCPE形态
* App形态

## 高速通道
应用场景：同地域/跨地域/跨账号两个VPC互联、VPC与本地IDC互连


### 边界路由器VBR
VBR提供一下功能：

## 云企业网
云企业网CEN是运行在阿里云私有全球网络上的一张高可用网络。云企业网通过转发路由器TR帮助您在跨地域专有网络之间，专有网络和本地数据中心间搭建私网通信通道，为您大招一张灵活、可靠、大规模的企业级云上网络

## 全球加速
## 云连接器
## 私网类型产品
## 公网类型产品 

# ECS
## ECS基本概念
ECS实例等同于一台虚拟服务器，内含CPU、内存、操作系统、网络配置、磁盘等基础组件。

### 云服务ECS使用的限制
* 仅弹性裸金属服务器和超级计算集群支持二次虚拟化，其他规格不支持安装虚拟化软件和二次虚拟。
* 不支持声卡应用。
* 不支持直接加载外接设备，如硬件加密狗、U盘、外接硬件、银行Ukey等。
* 不支持多播协议。如果需要多播，建议改为使用单播点对点。
* 日志服务不支持32位Linux系统云服务器

### 保证ECS正常运行的注意事项
* 创建ECS实力后，您有实例的管理员权限，阿里云没有权限登入你的实力。
* 禁止使用ECS实例做流量穿透服务。
* 不要卸载相关硬件驱动。
* 不要随意修改网卡MAC地址。
* 建议不要开启SELinux。
* 建议将相关软件都设置成开机启动。如果应用服务连接数据库，需要在程序中设置成自动重连机制。
## 产品架构
* 实例：等同于一台虚拟服务器
* 镜像：装机盘
* 存储块：数据存储
* 快照：某一时间点云盘的实时副本
* 网络：专有网络vpc
* 安全组：虚拟防火墙
## 地域
数据中心所在的位置
## 可用区
统一地域内，电力和网络相互独立的物理区域
* 同一可用区内实例的网络延迟更小
* 同一地域内可用区之间使用低时延链路相连，内网互通
## 实例规格
### 入门级实例
一系列面向中小网站或个人的实力规格总称。

非绑定CPU调度模式。

实例规格族： 共享型，突发性能型

适用场景：轻量级Web应用程序，轻负载应用，微服务，开发测试压测服务应用

### 企业级实例
具有独享且稳定的计算，存储，网络资源，适合业务稳定性很高的场景。

固定CPU调度

实例规格族： 通用性，计算型，内存型，大数据型等

适用场景：大型多人游戏前端，数据分析和计算，中大型Web服务，高精度编解码，渲染，大数据处理加工
### 弹性裸金属服务器
保留了物理机的功能与特性，全面支持嵌套虚拟化技术。
它融合了物理机与云服务的优势，实现了超强超稳的计算能力，居然被物理机级别的完整处理器特性，以及物理机级别的资源隔离优势，特别适合上云部署传统非虚拟化场景的应用。
## 实例的生命周期与状态
## 创建实例的步骤
* 选择付费模式
* 选择地域及可用区，创建完成后不支持更改
* 实例规格
* 选择镜像
* 选择存储并配置，选择系统盘，可选数据盘或者共享盘NAS
* 可选配置快照服务

完成基础设置后，下一步，网络与安全组。

* 选择网络
* 可选择分配公网IP
* 选择安全组
* 配置弹性网卡
* 可选配置IPv6

## 镜像

ECS镜像是创建ECS实例的基础模板，它包含了启动和运行实例所需的操作系统和预配置数据。在创建ECS实例时必须选择一个镜像，该镜像可以是只包含系统盘的单个存储云盘，也可以是包含系统盘和一个或多个数据盘的组合。本文介绍镜像类型、费用以及如何选择镜像等其他信息

镜像就是云服务ECS的装机盘，为云服务ECS实例提供操作系统，初始化应用数据，预装软件。通过镜像可以创建并部署云服务ECS。

### 镜像类型
* 公共镜像
* 自定义镜像: 基于实例创建，基
于快照创建，使用SMC自动导入，通过OSS手动导入
* 共享镜像
* 镜像市场镜像
* 社区镜像

自定义镜像基于实例（系统盘）或者快照（需包含系统盘）创建镜像，或者从本地导入的镜像，包含已部署的应用、数据等信息。通过共享镜像（跨账号）、复制镜像（跨地域）等操作，可以方便复制ECS实例。

社区镜像不支持共享、导出与复制。

## 快照
* 某一时间点云盘数据状态的备份文件
* 实现高IO云盘的数据备份，保证业务处理的正确性和服务不中断。
* 创建快照可能会降低磁盘的性能，尽量避开业务高峰。
* 第一次全量，后续增量。自动保存在**独立于用自己的OSS Bucket**。
* 目前仅部分地域支持复制快照。
* 针对ESSD云盘，您可以通过快照极速可用（本地快照）功能加快创建快照的速度，实现秒级创建快照。

### 快照回滚
当云盘因误删误改、勒索病毒等原因造成数据丢失时，您可以使用该云盘的历史快照回滚云盘，从而使改云盘的数据恢复到创建快照时的状态。
有以下的限制：
* 您已经为云盘创建快照，而且要回滚的云盘当前没有正在创建的快照。（**不可逆，部分数据丢失**）。
* 云盘未被释放。
* 更换操作系统后，历史系统盘快照不能用于回滚新的系统盘。
* 云盘被用作创建动态扩展或RAID阵列时，您必须预先停止所有I/O操作，再使用快照回滚。
*云盘必须已经挂挂载到某台ECS实例上，而且已经**停止实例**。

## ECS实例在VPC下IP地址分类
### 私有IP地址
根据实例所属的VPC和虚拟交换机网段，**VPC类型实例已经创建即被分配一个私有IP地址**

私有IP地址可以用于以下场景：
* 负载均衡。
* 同一局域网内ECS实例之间内网互访。
* 同一局域网内ECS实例与其他云服务（如OSS、RDS）之间内防互访。

您可以根据业务需要，在ECS管理控制台上修改私有IP地址。

|  维度   | PublicIP  | EIP |
|  ----  | ----  |  ----   |
| 使用场景  | 如果希望创建ECS实例时由系统自动分配IP地址，释放实例时同这个公网IP地址实例一起释放，不保留公网IP | 长期使用某个公网IP地址，需要将它绑定到指定ECS实例。EIP可以反复绑定和解绑。释放实例后可以EIP存在 |
| 获取方式  | 创建实例时，选择了分配公网IPv4地址，即分配一个PublicIP | 单独申请EIP，并绑定到未分配PublicIP的ECS实例 |
| 分配上限  | 一台ECS实例只能分配一个 | 一台ECS实例可以关联多个EIP |
| 解绑方式 | 只能释放不能解绑。可以按需将PublicIP转换为EIP | 支持解绑
| 释放方式 | 释放实例时，PublicIP一起释放。将带宽值设置为0Mbit/s，可以释放PublicIP| 不需要EIP时可释放
| 查看MAC地址 | VPC类型的ECS实例的公网访问通过私有网卡的映射完成，实例内部都无法查询到公网网卡

### 公网IP地址
VPC类型实例支持两种公网IP地址
* ECS系统分配的公网地址（**PublicIP**）。
* 弹性公网IP地址 **EIP**。
## ECS实例在经典网络下IP地址分类
### 内网IP地址
每台经典网络ECS的实例一定会被分配一个IP地址用于内网的通信，这个IP地址被称为内网IP地址。

经典网络内IP地址不支持组播和广播。

经典网络内网IP地址不支持修改。

### 公网IP地址
如果您购买了公网带宽，即公网带宽不为0Mbit/s，阿里云会为实例分配一个公网IP。

不支持EIP。

经典网络公网IP转化为EIP后：
* 采用按使用流量计费方式。
* 公网宽带值与原ECS实例保持一致。0Mbit/s转化为EIP自动升级为1Mbit/s
* 不能挂载到EIP上。
* 经典网络类型ECS实例具有公网网卡。无法保留公网网卡和相应的Mac地址。

## IPv6
### 使用IPv6步骤
* 搭建IPv6 VPC
* 分配IPv6地址
* 开通IPv6公网带宽
* 配置IPv6地址
* 添加IPv6安全组规则
* 测试网络连通性
* （可选）删除IPv6地址

## IP地址的相关操作
### 修改专有网络私有IP地址
可以通过直接修改专有网络中ECS的私有IP，也可以通过更改实例所属的交换机来更改ECS实例的私有IP

前提条件
* 实例的弹性网卡未设置辅助私网IP地址。
* 实例处于**已停止状态***。
* 如果要更换交换机，需确保交换区的可用区与实例的可用区相同。实例需要重新启动后，修改的私有IP生效。

### 公网IP转化为弹性公网IP（经典网络）
* 按使用流量计费方式。
* 公网带宽值和原ECS实例保持一致。
* 不能挂载到经典网络类型ECS实例上。
* 无法保留改公网网卡和相应的Mac地址
## ECS 安全
### 安全组
安全组是云上的虚拟防火墙，它包含安全组规则和安全组内的云资源（虚拟机、弹性网卡等）。用户可以配置安全组规则来允许或拒绝指定类型的网络流量通行，还可以基于安全组划定安全域，通过授权安全组访问的能力，来实现云资源之间的访问控制。

安全组是一种虚拟防火墙，用于控制安全组内ECS实例的出入流量。安全组分为普通安全组和企业安全组，一台ECS实例最多可以加入**5**个安全组，初次创建ECS实例时会自动创建一个默认安全组，默认安全组是普通安全组。
### 安全组规则的构成
单条自定义的安全组规则，由以下信息构成：

* 协议类型：匹配流量的协议类型。支持TCP、UDP、ICMP(IPv4)、ICMP(IPv6)和GRE。

* 端口范围：匹配流量的目的端口。对于TCP和UDP协议，可以指定一个斜线（/）分隔的端口范围，比如8000/9000，或22/22。对其他协议，该字段取值-1/-1。更多信息，请参见常用端口。

* 授权对象：入方向规则中匹配流量的源地址，出方向规则中匹配流量的目的地址。支持CIDR地址块（或IP地址）、安全组、前缀列表三种类型。具体如下：IPv4地址：例如192.168.0.100。IPv4 CIDR地址块：例如192.168.0.0/24。IPv6地址：例如2408:4321:180:1701:94c7:bc38:3bfa:9。接口将会对IPv6地址进行标准化处理，比如，2408:180:0000::1将会被处理为2408:180::1。IPv6 CIDR地址块：例如2408:4321:180:1701::/64。接口将会对IPv6 CIDR地址块进行标准化处理，比如，2408:4321:180:0000::/64将会被处理为2408:4321:180::/64。

* 安全组ID：支持授权当前账号下或其他账号下的目标安全组，使用目标安全组中ECS实例的内网IP来进行流量匹配，实现内网访问的控制。例如，安全组A中有ECS实例b，当您授权安全组A访问时，您实际授权的是安全组A中ECS实例b的内网IP的访问权限。

* 前缀列表ID：前缀列表是一些网络前缀（即CIDR地址块）的集合。授权对象为前缀列表时，该条规则占用的安全组规则配额数量，为前缀列表最大条目数，与前缀列表中已有条目数量无关。更多信息，请参见前缀列表概述。

* 授权策略：允许或拒绝。在基于流量的协议、端口和授权对象匹配到某条安全组规则后，会对流量执行授权策略指定的动作，来允许或拒绝流量放行。

* 优先级：取值范围为1~100，数值越小，代表优先级越高。安全组规则的排序，首先考虑优先级，其次考虑授权策略，更多信息，请参见安全组规则排序策略。

* 规则方向：分为入方向和出方向，入方向规则控制入站流量，出方向规则控制出站流量。

* 规则ID：在您添加安全组规则时，系统会为每条安全组规则生成唯一的ID。若您需要修改或删除已有安全组规则，您可以通过安全组规则ID，来指定要进行操作的安全组规则。
### 安全组实践基本建议
* 白名单而不是黑名单，即默认拒绝所有访问。
* 最小授权原则。
* 不用类型应用使用不同的安全组。
* 尽可能保持单个安全组的规则简洁。
* 不要随便更新安全组的规则。
* 不需要公网访问的资源不提供公网IP。
* 避免直接修改线上环境使用的安全组。
* 合理定义安全组名称、标签等。

## SSH密钥对
阿里云SSH密钥对是一种安全便捷的登录认证方式，用于在SSH协议中进行身份验证和加密通信。由公钥和私钥组成且仅支持Linux实例，满足您对更高安全性、便利性和自动化能力的业务需求。您可以直接在Windows环境和支持SSH命令的环境（例如Linux环境、Windows下的MobaXterm）中使用SSH密钥对连接Linux实例。

密钥对的安全强度远高于常规用户口令，可以杜绝暴力破解威胁。

便于远程登录大量Linux实例，方便管理。适合批量维护多台Linux实例。

使用时有以下限制：
* 如果使用SSH方式登入，则会禁用密码登入。
* 仅支持Linux实例。
* 一台Linux实例只能绑定一个密钥对。
* 实例状态运行中（Running）是绑定或解绑秘钥对，您需要重启实例使操作生效。
## 身份管理
为确保您的阿里云账号及云资源使用安全，如非必要都应避免直接使用阿里云账号（即主账号）来访问云服务器ECS。推荐的做法是使用RAM身份（即RAM用户和RAM角色）来访问云服务器ECS。
### RAM用户
阿里云的访问控制RAM（Resource Access Management）提供了强大的细粒度权限管理功能，适用于企业中多个部门或角色需要访问ECS资源的情况。为了保障敏感信息和关键业务流程的安全，您可以根据各部门或角色的具体职责分配不同的访问权限。通过实施权限分离策略，不仅能显著提升管理效率，还能有效降低信息泄露的风险。本文介绍如何通过控制RAM用户的权限，以实现对云服务器ECS资源的访问控制。

#### 场景介绍
假设您公司是使用ECS来托管应用程序和服务。其中，IT架构规划由管理人员主导，他们对所有ECS资源拥有控制权，包括但不限于创建资源、调整资源分配及安全策略配置等关键职责。开发人员负责项目的持续迭代和功能创新，并承担将项目部署到ECS上的任务。运维人员则承担起保障系统正常运转的责任，通过创建快照、创建镜像、执行相关脚本等方式维护现有服务。

针对这三类人员的需求，我们将设计如下权限方案：

管理人员：可以拥有创建、删除ECS实例及修改安全组规则等所有ECS操作权限。

开发人员：能够查看所有ECS实例的信息，但不能修改任何设置，同时可以登录ECS实例进行操作。

运维人员：具备创建部分资源的权限，但不具备删除资源的权限，如创建快照和镜像、执行脚本等任务。

### RAM用户组
当您的阿里云账号下有多个RAM用户时，可以通过创建用户组对职责相同的RAM用户进行分组管理和批量授权，实现高效地管理RAM用户及其权限。对于RAM用户组的使用，建议您：

在对RAM用户组授权时遵循最小权限策略原则。

在RAM用户职责发生变化时将其从不再归属的用户组中移除，避免权限滥用。

在某个用户组不再需要某些权限时移除用户组对应的权限。
### RAM角色
RAM角色是一种虚拟用户，可以被授予一组权限策略。与RAM用户不同，RAM角色没有永久身份凭证（登录密码或访问密钥），需要被一个可信实体扮演。扮演成功后，可信实体将获得RAM角色的临时身份凭证，即安全令牌（STS Token），使用该安全令牌就能以RAM角色身份访问被授权的资源。

#### 产品优势
* 使用STS Token，减少长期访问密钥泄露的分线
* STS Token具有时效性，可以自定义有效期，到期后自动失效，无效定期轮换。
* 可以为STS Token绑定自定义权限策略，提供更加灵活和精细的云资源授权。
## 基础安全服务
云服务器ECS提供了基础安全服务，包括异常登录检测、漏洞扫描、基线配置核查等。您可以在ECS控制台或者云安全中心看到您的云服务器安全状态。

提供5G以下DDos基础防护。

由**阿里云云安全中心**（Security Center）（云盾）提供云服务器ECS的基础安全服务，帮助您收集并呈现安全日志和云上资产指纹，主要提供免费版的漏洞检测、安全告警和基线检查服务。您可以在ECS管理控制台的概览页面或者云安全中心控制台查看相关安全信息。
### 计费说明
基础安全服务的计费说明如下：

云服务器ECS的基础安全服务为免费服务，不收取服务费用。

如果您需要升级为高级版或者企业版云安全中心，可以在云安全中心控制台免费试用或者购买服务。

## 实例启动模板
实例启动模板是一种用于快速创建实例的工具，其中包含了用于创建ECS实例的任意配置信息（**除实例密码**），包括**密钥对、RAM角色、实例类型和网络设置**等。每个模板可以有多个版本，每个版本可以配置不同的参数，您可以使用指定的模板的任意一个版本快速创建实例，提升效率及使用体验。实力启动模板不支持修改。

## 部署集
部署集是控制ECS实例分布的策略，使您能在创建ECS实例的时候就设计容灾能力和可用性。

针对追求高可用性的集群业务，可利用高可用或部署集组高可用策略，将ECS实例分散部署在不同的物理服务器上，以避免单点故障，提高业务的可用性；对于网络延迟高度敏感的应用（如高频交易、实时数据分析等），可利用网络低时延策略，将ECS实例集中部署到同一个网络拓扑范围内，缩短ECS实例间的网络通信延时。本文主要介绍部署集的部署策略、使用限制及如何使用部署集。

### 使用限制
* 部署集之间不支持相互合并。
* 部署集内不支持创建抢占式实例。
* 部署集不支持创建专有宿主机。
* 一个可用区最多创建20台ECS实例
* 不是所有规格都支持部署集。
* 在部署集内创建ECS实例时，或者重启按量付费ECS实例（节省停机模式）时，供货紧张任然会导致请求失败。

## 运维管理
### 系统事件
如果实例只挂载了云盘，可以选择：
* 自动重启恢复（默认）。
* 禁止重启恢复。

如果实例挂载了本地盘，可以选择：
* 自动重启恢复（默认）
* 禁止重启恢复
* 自动重新部署
### 运维知识
* 定期更新软补丁
* 网页本身内容大小、网络的宽带、是否有大量数据库的操作、是否引用过多其他网站的内容等操作会影响网站打开速度。
## 标签
标签可以识别资源和用户组别，允许企业或者个人将相同云服务器ECS资源归类。便于搜索和资源整合。
* 支持标签的服务：ECS实例、存储、快照、镜像、安全组等。
* 每个标签都由一对键值对（Key-Value）组成
* 每个实例最多可以绑定20个标签，每次最多绑定或解绑20个标签。
* 每个资源的任一标签的Key必须唯一，相同的Key会被覆盖。
* 不同地域中的标签信息不互通。

## 迁移
### 优势
* 支持多平台、多环境。
* 支持迁移不停机。
* 简单轻量且配置灵活。一键运行迁移后，全程自动托管。
* 数据传输安全有保证：默认采用SSL 2048位RSA密钥加密传输。

### 迁移数据库
数据传输服务，Data Tranmission Service，简称DTS，是阿里云提供的支持RDBMS、NoSQL、OLAP等数据库。

自建MySQL迁移至RDS MySQL实例的限制：
* DTS会尝试恢复七天之内迁移失任务。
* DTS支持结构迁移、全量数据迁移以及增量数据迁移。
* RDS MySQL实例的存储空间须大于自建MySQL数据库占用的存储空间。

## 多台ECS实例批量挂载同一NAS文件系统
仅支持Linux操作系统
仅支持运行中实例

## BGP机房优点


# 云存储

## 云存储优势
* 超大规模
* 高可扩展性
* 高可靠性和高可用性
* 按需服务
* 透明服务
* 管理和维护

公共云计算中使用的存储并非共享存储，而是分布式存储。

## 文件存储系统
### 存储类型
* 通用型NAS
* 极速型NAS - 时延敏感型企业引用
* 文件存储CPFS - IO密集型

不同存储类型的文件系统不能相互转换

### 文件存储NAS的访问协议
* NAF协议：适合Linux
* SMB协议：适合Windows

文件系统与协议类型强绑定，创建后无法改变。

通用型NAS支持NFS v3和NFS v4.0， 极速型NAS仅支持NFS v3。**NFS v3的性能是优于NFS v4.0**。

如果需要多个计算节点同时修改同一个文件，则需要NFS v4.0挂载以支持文件锁功能。

### 文件存储HDFS版
允许我们像Hadoop分布式文件系统中一样管理和访问数据。

多个计算节点可以同时访问同一个文件存储HDFS版实例，共享问价和目录。

在HDFS中，权限组是白名单。

初始下，每个阿里云会自动生成一个默认权限组，默认权限组不支持删除或修改。

不支持快照。不支持ACL。

### 多台ECS实例批量挂载同一NAS文件系统
* 仅支持Linux
* 仅支持状态为运行中的ECS实例
* ECS实例必须和NAS文件系统在同一地域内
* ECS实例和NAS可以在同一地区的不同可用区，所在VPC已打通即可。

# 存储块
## 本地盘
* 来自单台物理机
* 没有三副本机制
* 不支持：挂载本地盘，**使用快照创建本地盘**，**为本地盘创建快照**

## 专属块存储集群
* 支持作为ECS实例的系统盘。
* 支持作为ECS实例的数据盘
* 分为基础性专属块存储集群和性能型专属块存储集群。
* 不支持变配操作。
* 仅支持包年包月的计费方式。

## 云盘
* 三副本

    有三类角色，Master、Chunk Server和Client


* 可以定期创建快照
* 数据擦除机制

分类
|  类型   | 访问延时  | 选型和说明 |
|  ----  | ----  |  ----   |
| ESSD云盘| 小于等于0.5ms | 大型OLTP数据库（MySQL、 postgresql、 Oracel、 SQL server）、NoSQL数据库、ElasticSearch
|SSD云盘 | 0.5-2ms |适合I/O密集型、中小型数据库
|高效云盘 | 1-3ms | 开发和测试环境
|普通云盘 | 5-10ms| 不推荐



### 云盘加密
* 创建ECS实例后为云盘勾选加密后自动加密，无需自建和维护密钥管理基础设施。
* 利用密钥管理服务KMS加密。
* 使用加密后，系统会将从ECS实例传输到云盘的数据自动加密，并在读取时自动解密。
* 启用加密动能的云盘性能会低于未开启加密功能的云盘。

### 创建云盘
* 创建Linux的ECS，增加数据盘，需格式化数据盘，然后挂载数据盘。/dev/xvda/为系统盘。
* 创建Windows的ECS，不需要任何操作。

### 挂载数据盘
* 实例与云盘在同一可用区
* 被挂载实例为运行中或已停止，不能为已锁定。
* 云盘的状态为待挂载（Available）
* 一台ECS最多挂载64块数据盘

### 更换系统盘
* 系统盘ID会变。
* 系统盘的云盘类型、实例IP地址以及弹性网卡MAC地址保持不变。
* 自动快照和数据会丢失，手动快照不会。
* 如果需要保留系统盘数据，减少业务中断时长，建议使用服务器迁移中心SMC迁移操作系统。
* 手动创建的快照不会丢失，不会释放。自动快照会释放。
* 更换到Linux，会无法识别NTFS格式，需在下载ntfs-3G.
* 更换到Windows，会无法识别ext3，ext4，xfs等格式，需安装下载ext2read，ext2fsd等。
### 扩容系统盘
在更换系统盘的基础上指定更大的系统盘容量。不会扩容系统文件。

### 初始化系统盘
* 已创建快照。初始化会清空云盘写入的数据。
* 重新初始化必须先停止ECS实例。
* 安装的应用程序和产生的数据都会被删除。
* 自动快照，重新初始化后，设置依然有效。
* 不会改变ECS实例的IP地址和云盘ID。
* 不会删除系统盘的快照。

## 对象存储OSS的概念
海量、安全、低成本、高可靠的云存储服务。可提供99.9999999999%数据持久性， 可用性99.995%。

### 原理&概念
* 数据以对象Object的形式存储在存储空间Bucket中。创建Bucket需指定地域、访问权限、存储类型等属性。指定Object的文件名key作为其唯一标识。
* 距离近的地域访问速度最快。
* 以HTTP Restful API的形式对外提供服务，访问不同地域要不同的访问域名。
* Object操作具有原子性，操作要么成功要么失败。
* Object操作具有强一致性。一点收到上传成功的相应，上传的Object就已经可以读，且数据已经冗余写入多个设备中。
* 支持多种数据处理能力，如图片处理、视频截帧、文档预览、图片场景识别、SQL查询等。
* 没有大数据处理能力。

### 数据冗余机制
* 基于纠删码、多副本的数据冗余机制。
* 可支持两个存储设施并发损坏时，仍维持数据不丢失。
* 支持机房级别的容灾能力。

### 管理方式
* 通过控制台管理
* 通过API或者SDK管理OSS
* 通过工具管理：图形化管理工具ossbrowser、命令行工具 ossutil、FTP 管理工具、Bucket 挂载工具ossfs。
* 通过存储网关管理OSS。实现使用本地文件夹的方式使用OSS存储。

### 存储类型
| 对比指标 | 标准存储 | 低频存储 | 归档 | 冷归档 
|  ----  | ---- | ---- | ---- | ---- |
| 数据取回费用 | 无 | 按实际获取的数据量收取，单位GB | 按实际解冻量| 按实际解冻是选择的数据取回能力以及数据大小|
|图片处理|支持|支持|支持但需解冻|支持但需解冻|
|数据访问特点|实时访问毫秒级|实时访问毫秒级|需解冻，需一分钟|需解冻几个小时，按选择的取回能力决定|
|适用场景|各种社交、分享图片、音视频应用、大型网站、数据分析、程序下载|较低访问频率，平均每月访问1到2次的业务场景|数据长期保存的业务场景，如档案、医疗影像|需要超长时间存放的极冷数据，如大数据及人工智能领域长期积累的原始数据|

* 标准存储：本地冗余LRS和同城冗余LRS
* 低频访问存储：本地冗余LRS和同城冗余LRS
* 同城冗余数据设计持久性99.9999999999（12个9），本地冗余则为11个9
* 服务可用性同城比本地高

## 存储空间Bucket
在是上传数据到OSS之前，您需要在OSS所支持的地域中穿件一个存储空间，然后将无限量的对象Object上传到Bucket中。
### 命名规范
* 小写字母、数字、-
* 长度3-63

### 特点
* 与ECS地域相同，地域不可修改。
* 内部是扁平，没有文件体统目录等概念。
* 名字是唯一，创建后无法修改。
* 没有空间的限制，自动扩容。

### 使用限制：
* 同一地域内创建的存储空间总数不超过100个。
* 名称在OSS范围内必须唯一。
* 创建存储空间后，其名称、所在地域、存储类型、冗余类型不支持修改。
* 单个存储空间的容量不限制。

### 通过云存储网关挂载OSS
通过云存储网关将OSS的Bucket作为文件系统挂载至ECS中使用。

* 文件网关将OSS Bucket对象结构与NAS文件系统的目录和文件建立映射关系。
* 块网关在OSS中创建**存储卷**，提供Internet小型计算机系统接口（iSCSI）协议访问。 

#### 使用限制
* 已开通云存储网关。
* 已创建与目标Bucket同地域的专用网络VPC和交换机。
* 已创建与OSS同地域的ECS实例。


## 对象Object
Object是OSS存储数据的基本单元，也被称为OSS的文件。
### 对象构成
* key: 对象ID
* Data: 对象数据
* Meta: 对象属性
### 对象特征
* **不支持修改**，可以覆盖。
* 对象没有目录层级结构的关系，文件名称可以有/，看起来有目录。
* 命名不能已正斜杠或反斜杠开头。
* 单个文件最大**48.8TB**。

### 上传和管理Object
#### 简单上传
* 适合小文件，不超过5G。
* 有同名则覆盖。
* 基于put或post方式的http请求。
* 简单上传支持**使用OSS控制台、图形化管理工具ossbrowser、使用阿里云SDK、命令行工具 ossutil、使用REST API**。

#### 追加上传
* 适合小文件，不超过5G。
* 生成的Object类型为Appendable，且仅支持在Appendable类型的Object后**直接追加内容**，且每次追加的上传数据都能够及时可读。

#### 表单上传
* 适合小文件，不超过5G。
* 表单上传适用于在HTML网页上上传Object。
#### 分片上传
* 上传大文件，可以使用分片上传，最大不超过48.8TB。
* 需支持断点上传。
* 网络条件较差，和OSS的服务器之间的链接经常断开。
#### 断点上传
* 通过断点续传的方式将文件上传到OSS前，您可以通过Checkpoint文件指定断点记录。如果**上传中出现网络异常或者程序奔溃导致文件上传失败时，将从断点记录处继续上传为上传完成的部分**。
* 适合大文件，支持并发、断点续传、自定义分片大小。
* 最大不超过48.8TB。
* 当前仅支持通过SDK的方式实现断点续传上传。
### Object删除方式
* 生命周期规则： 可以基于**最后一次修改时间以及最后一次访问时间**的策略创建生命周期规则，定期将多个文件存储转为指定存储类型，或者将过期的Object和碎片删除，从而节省存储费用。

### 标签管理
* 存储空间的标签功能对Bucket进行分类管理。
* 对象标签对存储空间的中的Object进行分类。

## 图片处理服务IMG
* 支持海量数据处理，可用性高。
* 需要收费，包括图片处理、请求费用、流量费用。
### 常见功能
* 获取图片信息
* 图片格式转换
* 图片缩放、裁剪、旋转
* 图片添加图片、文字、图文混合水印。不支持图片文字识别。
* 自定义图片处理样式。
* 通过管道顺序调用多种图片处理功能。

### 处理图片的方式
* 通过文件URL处理图片：通过URL处理图片的方式有两种，一种是添加图片处理参数，另一种是添加图片样式参数。多个参数通过正斜线（/）连接。
* 通过SDK处理图片：在SDK中添加图片参数或图片样式参数的方式来处理图片。
* 使用REST API：通过在GetObject接口中天街图片处理参数或图片样式参数的方式处理图片。如果自定义要起较高，可以直接发起REST API。

### 图片处理的限制
* 处理图片是OSS用户上传到Bucket里的Object。
* 图片格式只支持JPG、PNG、BMP、GIF、WebP、TIFF。
* 原图大小不能超过20MB。
* 除旋转对应的原图高或者宽不能超过**4096px**，其他操作对应原图高或者宽不能超过30000px。且总像素不能超过2.5亿px。
* 缩放后图片限制宽或者高不能超过16384px。
* 仅支持对动态图片（例如GIF格式图片）进行缩放、裁剪、旋转以及添加图片水印的操作。
* 每个存储空间下最多创建50个样式。
### 图片处理
* 对象存储OSS图片处理服务默认不保存处理后的图片。
* 可以通过URL或者SDK的方式进行图片处理持久化。
* 原图所在Bucket和处理后图片转存的目标Bucket可以相同也可以不同，但必须属于同一账号下的相同地域。
### 管道Channel
* Channel是IMG上的命名空间，也是计费、权限控制、日志记录等高级功能的管理实体。
* IMG名称在整个图片处理服务器中具有全局唯一性，且不能修改。
* 每个用户最多可创建10个Channel，每个Channel放Object数量没有限制。
* Channel跟OSS的Bucket相对应，即用户只能创建与自己在OSS上Bucket同名的Channel。

## 数据安全
### 访问控制
#### 授权
* 基于用户授权RAM/STS Policy
* 基于资源授权Bucket Policy

#### 读写权限ACL
* Obejct优先于Bucket。
* 共有读写 public-read-write。
* 公共读，私有写 public-read。
* 私有读写 private。
### 权限控制
* 开发环境和正式环境中的应用使用不同的Bucket。
* 允许某个应用读，另一个应用写通一个Bucket里的文件。
* 让某个应用临时读写某个Bucket，凭证过期后无法访问。
* 不同的应用是应该访问不同的Bucket，权限不仅需要有允许和拒绝，也需要区分读和写。
* 使用STS临时访问凭证访问OSS。
* 鉴权失败返回403.

### 数据加密
服务端加密：

* 使用KMS托管密钥加密。
* 使用OSS完全托管加密。

客户端加密：

* 使用KMS托管加密用户主密钥。
* 使用用户自助管理密钥。

## 版本控制
* 版本控制是针对Bucket级别的数据保护功能，数据的覆盖和删除都会将以历史版本的形式保留下来。
* 新建Bucket时指定，之后不能再变更。
* 版本控制有三种状态： 未开启、开启、暂停。一旦开启，无法返回至未开启。
* 同一Bucket中，版本控制与合规保留策略无法同时配置。
* 如果Bucket开启了版本控制，上传文件时附加的覆盖同名文件请求头x-oss-forbid-overwrite将不在生效。

## 合规保留策略
* Bucket级别。
* 允许一条。
* 基于**时间**的合规保留策略。

## 防盗链
OSS支持对Bucket设置防盗链，即通过对访问来源设置白名单机制，避免资源被其他人盗用。

原理实现：
设置HTTP请求头Referer白名单以及是否允许空Referer，限制仅白名单中的域名可以访问您的Bucket内的资源。

校验规则：
仅当通过签名URL或者匿名访问Object时，进行防盗链验证。请求的Header中包含Authorization字段，不进行防盗链验证。

### 防盗链匹配原则
* 如果Referer白名单为空，则允许所有请求。
* 如果白名单不为空，且不允许空Referer，则只有Referer属于白名单的请求被允许，其他请求，包括Referer为空的请求都会被拒绝。
* 如果白名单不为空，且允许空Referer，则Referer为空的请求和符合白名单的请求被允许，其他请求，包括Referer为空的请求都会被拒绝。

### 匹配方式
支持通配符匹配，通配符*表示使用星号代替0个或者多个字符，通配符问号？代替一个字符。

## 数据容灾
* 同城冗余存储。可以满足关键业务系统对于恢复时间目RTO以及恢复点目标RPO等于0的强需求。
* 跨区域复制。跨不同OSS数据中心（地域）的Bucket自动、异步（近实时）复制对象，它将Object的创建、更新和删除操作从源存储空间复制到不同区域的目标存储空间。
## OSS高防
OSS高防是OSS结合DDoS高防推出的DDoS攻击代理防护服务。当收保护的存储空间遭受大流量攻击时，OSS高防会将攻击流量牵引至高防集群进行清洗，并将正常访问流量回源到目标Bucket，确保业务能够正常进行。
### 防护原理
OSS默认使用DDoS原生防护。当用户开通了OSS高防后，**当攻击频率超出了DDoS原生防护的防御阈值后**，OSS高防会将攻击流量牵引至高防集群进行清洗，并将正常访问流量回源到目标Bucket，确保业务能够正常进行。攻击结束后，受到攻击Bucket会切回至DDoS原生防护。

### 使用限制
* 每个地域可以创建一个高防实例，每个实例只能绑定同一地域下的10个Bucket。
* 在Bucket绑定高防实力后，用户无法通过浏览器预览Bucket内的资源。OSS默认不对Bucket关联的自定义域名进行防护。如需防护，要在OSS高防控制台添加要防护的自定义域名。每个Bucket防护的自定义域名数量上限是5个。

## 回源
当请求者请求对象数据OSS不存在时，本应该返回404。如果设置了回源规则，请求者即可通过回源规则从OSS获取正确的数据。

回源分为**镜像回源**和**重定向**。镜像回源主要用于数据无缝迁移。

## 访问OSS
* 通过外网访问OSS。外网指的是互联网。通过外网访问的写入流量（写）是免费的，流出流量（读）是收费的。方式：1. 以URL的形式访问OSS Object；2. 通过OSS SDK 配置外网访问域名。

* 通过内网访问OSS。内网产生的流入流出流量均免费，但是请求次数仍会计费。方式：1. 以URL的形式访问OSS Object；2. 通过ECS使用OSS SDK配置内网Endpoint。

* 同地域内网互通，跨地域内网不互通。
* 外网地址：https//{BucketName}.oss-cn-hangzhou.aliyuncs.com
* 内网地址：https//{BucketName}.oss-cn-hangzhou-internal.aliyuncs.com

* 与不同地域的ECS实例或者公网用户可以通过配置ECS反向代理，间接实现通过OSS内网地址访问OSS资源。
* 通过在ECS实力上配置OSS的反向代理，实现通过固定IP地址访问OSS的存储空间。
## 自定义域名
* 已注册且绑定中国内地的Bucket的域名已在中国工信部备案。
* 自定义域名支持传输加速功能。
* 通过托管证书，让自定义域名支持HTTPs。
* 在OSS管理控制台中可以选择自动添加或者修改域名的CNAME记录。（可以选择“自动”或者“手动”添加域名解析）。
* OSS域名绑定仅支持**三级域名**。
* 绑定自定义域名，可以在浏览器直接打开这类文件，而不是直接下载。
## 通过Web端上传
* 表单上传
* OSS Browser.js SDK
* 支付宝、微信小程序
## 静态网站托管
* 如果网页都由静态内容构成，可以使用静态网站托管将网站托管到OSS的存储空间，使用Bucket的访问域名或者自定义域名。
* 静态网站是指网页都是由静态内容构成，包括客户端执行的脚本，例如JavaScript。
* 如果托管的是HTTPS，静态网页，需要托管SSL证书。
* 默认首页是用户通过浏览器访问静态网站域名时，OSS返回的网站首页。
* 默认404页是指Bucket内文件出现404错误时，OSS返回的页面。
* 默认首页和默认404页指定文件的读写权限ACL设置为public-read，确保改文件允许匿名访问。
* 如需确保访问静态网页是预览行为，您必须为Bucket绑定自定义域名。
## 访问日志转存
* OSS会将这个Bucket的访问日志，以小时为单位，按照固定命名规则，一般按日期命名，生产一个Object存放到指定的Bucket中。
* 生产日志的源Bucket和存储日志的目标Bucket可以相同也可以不相同，但必须属于同一个账号下的相同地域。
* 关闭日志转存前，OSS的日志会一直生成。用户可以通过生命周期规则，基于最后一次修改时间，定期删除日志。

## 数据迁移
### ossimport
* 是一款讲数据迁移至OSS的工具。本身不收费。
## 传输加速
OSS传输加速利用全球分布的云机房，将全球各地用户对您Bucket的访问，经过智能路由器解析至就近的接入点，使用优化过后的网络协议，为云存储的上传、下载提供端到端的加速方案。
* 开启传输加速后必须用OSS的传输加速域名才会提升访问速度。
* 传输加速Endpoint仅支持HTTP/HTTPS协议的API接入，不支持RTMP协议的非HTTP/HTTPS协议的API接入。
* 开启全球加速后，Bucket会保留默认Endpoint的基础上，新增一下两种传输加速Endpoint。
* 全球加速Endpoint：oss-accelerate.aliyuncs.com。
* 非中国内地加速Endpoint：oss-accelerate-overseas.aliyuncs.com。
## 计费
* 上传：内网，外网都不收费。
* 下载：内网不收取费用，外网收取流量费用。
* 计费为小时为周期。
* 资源包最终呈现出来的效果还是按量计费。
* 资源包抵扣顺序为，地域存储包>中国大陆通用存储包>SCU>按量计费。
* **请求者付费模式**：请求者支持访问数据时产生的费用，而Bucket拥有者支付存储费用。
* 除去基础的存储、流量、请求费用外，增值服务也需要付费：数据处理费用、对象标签费用、传输加速费用、临时存储费用、DDos防护费用、敏感数据保护费用、OSS违规检测费用。
* 降低费用的方案：内网访问、使用CDN、合理安排存储类型，定期删除过期数据、资源包。








